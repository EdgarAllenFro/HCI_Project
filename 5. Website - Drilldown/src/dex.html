<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>Metric Operations</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>

<style>
@import url(https://fonts.googleapis.com/css?family=Karla:400);
body{
	font-family: Karla, sans-serif;
	zoom: 110%;
}
</style>
</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
<div class="container">
<div class="navbar-header">
<a class="navbar-brand" href="#">Metric Operations</a>
</div>
<div id="navbar" class="navbar-collapse collapse">
<ul class="nav navbar-nav navbar-middle">
<li><a href="index.html">Home</a></li>
<li><a href="demo/vas.html">Volume Availability Status</a></li>
<li class="active"><a href="#">DEX Exception</a></li>
<li><a href="pph.html">Packages Per Hour</a></li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Manager<span class="caret"></span></a>
<ul class="dropdown-menu">
<li><button type="button" id="Reginald Cruz" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;" >Reginald Cruz   </button></li>
<li><button type="button" id="Andre Hunter" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;">Andre Hunter  </button></li>
<li><button type="button" id="Leona Watson" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;" >Leona Watson  </button></li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Location<span class="caret"></span></a>
<ul class="dropdown-menu">
<li><button type="button" id="ORHA" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;" >ORHA   </button></li>
<li><button type="button" id="NYCA" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;">NYCA  </button></li>
<li><button type="button" id="GAIA" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;" >GAIA  </button></li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">District<span class="caret"></span></a>
<ul class="dropdown-menu">
<li><button type="button" id="Bostonian" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;">Bostonian  </button></li>
<li><button type="button" id="Big Apple" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;">Big Apple  </button></li>
<li><button type="button" id="Capital" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;">Capital  </button></li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
<a href="#" class="dropdown-toggle" id="RegionDrop"  data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Region<span class="caret"></span></a>
<ul class="dropdown-menu">
<li><button type="button" id="Eastern" onclick="drilldownupdate(this);" style="width: 100%; height: 50%;">Eastern</button></li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav navbar-right" width = 50>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Div<span class="caret"></span></a>
<ul class="dropdown-menu">
<li><button type="button" id="US Ops" onclick="drilldowndivision();" style="width: 100%; height: 50%;">Us Ops</button></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>
<div class="container">
<div class="jumbotron">
<p>Current Level:<b id='DrillDownHeader'>Us Ops</b> </p> 

	<p>
	<div class="form-group">
	<div class="col-xs-4">
	<label>Select Date Range:</label>
	<input type="text" class="form-control" name="daterange" value="" />
	</div>
	</div>
	</p>

<p>
<!--
<div id="body" style="width:50%"> -->
	<!-- input idea from: https://mounirmesselmeni.github.io/2012/11/20/reading-csv-file-with-javascript-and-html5-file-api/ -->
	<!--
	<input type="file" id="csvFileInput" onchange="handleFiles(this.files)" accept=".csv"> -->
	<canvas id="polarAreaChartCanvas" height='80' width='200'></canvas>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	<script src="main.js"></script>
<!--
</div>
-->
<!-- <img src="../img/dex.png" /> -->
</p>
</div>
</div>
<script type="text/javascript">
$(function() {
$('input[name="daterange"]').daterangepicker(
{
	timePicker: false,

    locale: {
      format: 'MM-DD-YYYY'
    },
    startDate: '03-20-2018',
    endDate: '03-20-2018',
	minDate: '03-20-2018',
	maxDate: '03-21-2018'
}, 


function(start, end, label) {

var startStr = start.format('MM-DD-YYYY');
var endStr = end.format('MM-DD-YYYY');

var s_date = new Date(startStr);
var e_date = new Date(endStr);


	var all_dex = [];
	var all_labels = [];
	var dummy_data = [];
	var dex_count = [];
	var labels = [];
	var exists = 0;
	

	//only includes data in the master array that is within the date parameters
	for(var i =0; i<json.length;i++){
		var temp_date = new Date(json[i].Date);
		console.log(s_date <= temp_date);
		if((s_date <= temp_date) && (e_date >= temp_date)){
			all_dex.push(json[i].DEX);
			all_labels.push(json[i].Description);
		}
	}
	
	console.log(all_dex);
	
	for(var i=0; i <= all_dex.length; i++){
		if(dummy_data.length == 0){
			dummy_data.push(all_dex[i]);
			labels.push(all_labels[i]);
			dex_count.push(1);
		}
		exists = 0;
		for(var j=0; j <= dummy_data.length; j++){
			if(all_dex[i] == dummy_data[j]){
				dex_count[j]++;
				exists = 1;
				break;
			}
		}
		if(exists != 1){
			dummy_data.push(all_dex[i]);
			labels.push(all_labels[i]);
			dex_count.push(1);
		}

		
	}
	dex_count.pop();

	console.log(dummy_data);
	console.log(dex_count);
	 
	polarAreaChart.data.datasets[0].data = dex_count;
	polarAreaChart.data.labels = labels;
	polarAreaChart.update();
	

});
	
});
function drilldownupdate(iden){
		var loc_id = iden.innerText;
		var level = 0;
		var ddheader = "";
		var all_dex = [];
		var all_labels = [];
		var dummy_data = [];
		var dex_count = [];
		var labels = [];
		var exists = 0;
		
		
		
		for(var i =0; i<json.length;i++){
			console.log(json[i].Location == loc_id);
			console.log("ORHA"==json[i].Location);
			console.log("US Ops"==loc_id);
			console.log(json[i]["Division"]);
			console.log(json[i].Region);
			console.log(json[i].District);
			console.log(json[i].Location);
			console.log(json[i]["Senior Manager"]);
			console.log(loc_id);
			if("US Ops" == loc_id){
				level = 1;
				ddheader = "US Ops";
				break;
			} if(json[i].Region == loc_id){
				level = 2;
				ddheader = "US Ops";
				ddheader += " - ";
				ddheader += json[i].Region;
				break;
			} if(json[i].District == loc_id){
				level = 3;
				ddheader = "US Ops";
				ddheader += " - ";
				ddheader += json[i].Region;
				ddheader += " - ";
				ddheader += json[i].District;
				break;
			} if(json[i].Location == loc_id){
				level = 4;
				ddheader = "US Ops";
				ddheader += " - ";
				ddheader += json[i].Region;
				ddheader += " - ";
				ddheader += json[i].District;
				ddheader += " - ";
				ddheader += json[i].Location;
				break;
			} if(json[i]["Senior Manager"] == loc_id){
				level = 5;
				ddheader = "US Ops";
				ddheader += " - ";
				ddheader += json[i].Region;
				ddheader += " - ";
				ddheader += json[i].District;
				ddheader += " - ";
				ddheader += json[i].Location;
				ddheader += " - ";
				ddheader += json[i]["Senior Manager"];
				break;
			}
		}
		
		console.log(ddheader);
		document.getElementById('DrillDownHeader').innerHTML = ddheader;
		
		switch (level){
			case 1:
				for(var i =0; i<json.length;i++){
					if("US Ops" == loc_id){
						all_dex.push(json[i].DEX);
						all_labels.push(json[i].Description);
					}
				}
				break;
				
			case 2:
				for(var i =0; i<json.length;i++){
					if(json[i].Region == loc_id){
						all_dex.push(json[i].DEX);
						all_labels.push(json[i].Description);
					}
				}
				break;
				
			case 3:
				for(var i =0; i<json.length;i++){
					if(json[i].District == loc_id){
						all_dex.push(json[i].DEX);
						all_labels.push(json[i].Description);
					}
				}
				break;
				
			case 4:
				for(var i =0; i<json.length;i++){
					if(json[i].Location == loc_id){
						all_dex.push(json[i].DEX);
						all_labels.push(json[i].Description);
					}
				}
				break;
				
			case 5:
				for(var i =0; i<json.length;i++){
					if(json[i]["Senior Manager"] == loc_id){
						all_dex.push(json[i].DEX);
						all_labels.push(json[i].Description);
					}
				}
				break;
		}
		console.log(all_dex);
		
		for(var i=0; i <= all_dex.length; i++){
			if(dummy_data.length == 0){
				dummy_data.push(all_dex[i]);
				labels.push(all_labels[i]);
				dex_count.push(1);
			}
			exists = 0;
			for(var j=0; j <= dummy_data.length; j++){
				if(all_dex[i] == dummy_data[j]){
					dex_count[j]++;
					exists = 1;
					break;
				}
			}
			if(exists != 1){
				dummy_data.push(all_dex[i]);
				labels.push(all_labels[i]);
				dex_count.push(1);
			}

			
		}
		dex_count.pop();

		console.log(dummy_data);
		console.log(dex_count);
		 
		polarAreaChart.data.datasets[0].data = dex_count;
		polarAreaChart.data.labels = labels;
		polarAreaChart.update();
		
	}
	
function drilldowndivision(){
		var all_dex = [];
		var all_labels = [];
		var dummy_data = [];
		var dex_count = [];
		var labels = [];
		var exists = 0;
		

		//only includes data in the master array that is within the date parameters
		for(var i =0; i<json.length;i++){
			all_dex.push(json[i].DEX);
			all_labels.push(json[i].Description);
		}
		
		console.log(all_dex);
		
		for(var i=0; i <= all_dex.length; i++){
			if(dummy_data.length == 0){
				dummy_data.push(all_dex[i]);
				labels.push(all_labels[i]);
				dex_count.push(1);
			}
			exists = 0;
			for(var j=0; j <= dummy_data.length; j++){
				if(all_dex[i] == dummy_data[j]){
					dex_count[j]++;
					exists = 1;
					break;
				}
			}
			if(exists != 1){
				dummy_data.push(all_dex[i]);
				labels.push(all_labels[i]);
				dex_count.push(1);
			}

			
		}
		dex_count.pop();

		console.log(dummy_data);
		console.log(dex_count);
		 
		polarAreaChart.data.datasets[0].data = dex_count;
		polarAreaChart.data.labels = labels;
		polarAreaChart.update();
	
		document.getElementById('DrillDownHeader').innerHTML = "US Ops";
	}
</script>
</body>
</html>